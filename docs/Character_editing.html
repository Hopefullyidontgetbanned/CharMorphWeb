<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Character editing &mdash; Your Project Name  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css?v=7bb85b03" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/custom.js?v=5dbb1cf8"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: green" >

          
          
          <a href="index.html" class="icon icon-home">
            Your Project Name
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Introduction.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Introduction.html#licensing">Licensing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="History.html">History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="History.html#digital-humans">Digital Humans</a></li>
<li class="toctree-l2"><a class="reference internal" href="History.html#open-source-digital-humans">Open Source Digital Humans</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Hair.html">Hair</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Hair.html#mb-lab">MB-Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hair.html#antonia">Antonia</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hair.html#reom">Reom</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: green" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Your Project Name</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Character editing</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Character_editing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="character-editing">
<h1>Character editing<a class="headerlink" href="#character-editing" title="Link to this heading"></a></h1>
<section id="base">
<h2>Base<a class="headerlink" href="#base" title="Link to this heading"></a></h2>
<p>Apart from character creating CharMorph also has editing tools
that helps to integrate new characters to CharMorph, as well as edting existing ones.</p>
</section>
<section id="structure">
<h2>Structure<a class="headerlink" href="#structure" title="Link to this heading"></a></h2>
<p>Every Characer is located in <code class="docutils literal notranslate"><span class="pre">(Add-on)/data/characters/(character-name)</span></code></p>
<p>The folder structure is usually like;</p>
<dl class="field-list simple">
<dt class="field-odd">hairstyles<span class="colon">:</span></dt>
<dd class="field-odd"><p>each individual hairstyles is stored as numpy vertices.</p>
</dd>
<dt class="field-even">joints<span class="colon">:</span></dt>
<dd class="field-even"><p>Joint positions are stored using vertex weights.</p>
</dd>
<dt class="field-odd">morphs<span class="colon">:</span></dt>
<dd class="field-odd"><p>All morphs are stored here including L1/L2/L3 morph types.</p>
</dd>
<dt class="field-even">weights<span class="colon">:</span></dt>
<dd class="field-even"><p>vertex weights are stored, here as a single numpy file based on rig set.</p>
</dd>
<dt class="field-odd">char.blend<span class="colon">:</span></dt>
<dd class="field-odd"><p>the base of the character is stored here, without shapekeys or vertex weights, all material slots should be blank and be configured in the config file.</p>
</dd>
<dt class="field-even">config.yaml<span class="colon">:</span></dt>
<dd class="field-even"><p>the configuration of the characters such as texture sets, metadata, rig types, etc</p>
</dd>
<dt class="field-odd">eyebrows.blend<span class="colon">:</span></dt>
<dd class="field-odd"><p>hair is stored using blender’s particle system on a desired mesh and each of them must be enabled in the viewport. then they are added in the hair menu at user discretion.</p>
</dd>
<dt class="field-even">rigs.blend<span class="colon">:</span></dt>
<dd class="field-even"><p>metarig data is stored, and a rig is generated based on internal/external blender plugins like rigify/auto-rig pro.</p>
</dd>
<dt class="field-odd">faces.npy<span class="colon">:</span></dt>
<dd class="field-odd"><p>Stores the default topology vertuces and allows the altnernate topology feature to work on a given character.</p>
</dd>
</dl>
</section>
<section id="morphs">
<h2>Morphs<a class="headerlink" href="#morphs" title="Link to this heading"></a></h2>
<blockquote>
<div><p>Morphs are the Lifeblood of all Character Creators, including Charmorph.</p>
</div></blockquote>
<p>They work similarly to Shapekeys but support a destructive workflow
Morphs are Created by exporting Shapekeys to external files instead of being stored in the mesh itself.</p>
<p>Morph Level:</p>
<dl class="field-list simple">
<dt class="field-odd">L1<span class="colon">:</span></dt>
<dd class="field-odd"><p>Reference Body Type: (Shape Basis) Each L1 Morph can have it’s own set of L2/L3 Morphs</p>
</dd>
<dt class="field-even">L2<span class="colon">:</span></dt>
<dd class="field-even"><p>Minor Morphs: This is where most of the morphs are and are the ones that make characters look more unique.</p>
</dd>
<dt class="field-odd">L3<span class="colon">:</span></dt>
<dd class="field-odd"><p>Expression Morphs: This is for Facial Action Coding System (FACS) Shapekeys</p>
</dd>
</dl>
<p>L2 Morphs:</p>
<a class="reference internal image-reference" href="images/CharmorphExportSingleMorph.png"><img alt="Export Single Morph" src="images/CharmorphExportSingleMorph.png" style="width: 144px;" /></a>
<ul class="simple">
<li><p>Exports Morph as a numpy file with the <code class="docutils literal notranslate"><span class="pre">.npy</span></code> file extension</p></li>
</ul>
<p>Note: if you unfamiliar with regex, remove the morph regex expressions when exporting morphlists or multiple morphs.</p>
<p>Metadata:</p>
<p>All L2/L3 Morphs must be listed without their extension in their respective <code class="docutils literal notranslate"><span class="pre">morphs.json</span></code> files in order to be recognized by the add-on.</p>
<p>Syntax is simple for those accustomed to JSON.
<code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;morph&quot;:</span> <span class="pre">&quot;FILENAME&quot;},</span></code></p>
<p>By default Morphs will be able to only go from 0 to 1 but can be overidden by this syntax
<code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;morph&quot;:</span> <span class="pre">&quot;FILENAME&quot;,</span> <span class="pre">&quot;min&quot;:</span> <span class="pre">-1.0,</span> <span class="pre">&quot;max&quot;:</span> <span class="pre">1.0},</span></code></p>
<p>The UI sorts the morph into categories based on the first word of the morph without a seperator so in order to keep the UI Clean it’s reccomended to follows this naming scheme.</p>
<p><code class="docutils literal notranslate"><span class="pre">CategoryName_Morph</span></code></p>
<p>For Example:</p>
<p><code class="docutils literal notranslate"><span class="pre">Chin_Mentalis_Portrusion</span></code>
or <code class="docutils literal notranslate"><span class="pre">Fantasy_No_Nose</span></code></p>
<p>Charmorph also has a UI Seperator to help keep things in the same category organized and less confusing to look at</p>
<p><code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&quot;separator&quot;:</span> <span class="pre">true},</span></code></p>
</section>
<section id="rigging">
<h2>Rigging<a class="headerlink" href="#rigging" title="Link to this heading"></a></h2>
<p>While morphing, your character can sufficiently change proportions
so bone locations need to be adjusted too. In CharMorph this is
implemented by binding bone locations to vertex groups.</p>
<p>Each bone joint has a special vertex group named
<code class="docutils literal notranslate"><span class="pre">joint_{bone</span> <span class="pre">name}_{head|tail}</span></code>. Joint location is calculated as
weighted average of locations of vertices included in the group,
optionally offseted by some constant location.
These vertex groups can be created manually using Edit mode or
weight painting, or then can be created by CharMorph rigging tools.</p>
<p>To use CharMorph rigging tools you need to select character mesh in
“Char” property of Rigging panel and have metarig in edit mode.</p>
<p>“Selected joints to VG” button moves selected joints to their
final positions according to their vertex groups.</p>
<p>“Recalc vertex groups” button calculates vertex group for selected
joint according to selected calculation algorighm.
If “Auto snap” option is enabled it also move the joint to
the calculated position</p>
<p>There are different calculation algorighms for different types of
joints. Hsually we have 3 types of joints:</p>
<ul class="simple">
<li><p><strong>interior joints:</strong> the most common type of joints.
They are located inside character mesh.
They include limbs, spine, neck and head.</p></li>
<li><p><strong>surface joints:</strong> located on the surface of character mesh
They are usually used for face expression bones</p></li>
<li><p><strong>outer joints:</strong> located outside of character mesh
They are usually used for helper bones like Rigify heel bone
You need to use offsets to make CharMorph correctly place such bones.</p></li>
</ul>
<p>Calculation methods for surface joints:</p>
<ul class="simple">
<li><p><strong>n nearest vertices:</strong>
This method is usually used to snap joint to nearest vertex. In rare cases
it also can be used to bind joint to multiple vertices also for interior joints.</p></li>
<li><p><strong>nearest face:</strong> snaps joint to surface of nearest face.
It also has “snap distance” option that allows optionally to snap joint to nearest
edge or vertex if it is within specified distance.</p></li>
<li><p><strong>nearest edge:</strong> snaps joint to nearest edge</p></li>
<li><p><strong>by distance:</strong> searches vertices within selected distance and snaps joint to them</p></li>
</ul>
<p>Calculation methods for interior bones:</p>
<ul class="simple">
<li><p><strong>Raycast:</strong>
Idea of this method consists of casting of rays from joint location to 2 opposite directions
When rays hit face surface, we calculate vertex groups for hit faces and then we assign
certain weights to these counterpart faces to match joint location as close as possible.
Several such ray pairs can be casted at once.
“Raycast bone axes” uses bone axes to cast such ray pairs.
“Raycast global” can either use global axes or use axes of selected object (usually empty)</p></li>
<li><p><strong>Cross lines:</strong>
This method takes certain amount of nearest vertices and iterates over all possible lines
that can be drawn through every pair of vertices. Then it takes n lines that are nearest
to the joints and assigns to each pair of vertices weights to match joint location as close
as possible.</p></li>
<li><p><strong>Bounding box:</strong>
Tries to find 8 vertices that consist smallest bounding box of the joint and assign them
weights according to joint location. Currenly this method doesn’t work very good so it is
considered experimental</p></li>
</ul>
<p>Other calculation methods:</p>
<ul class="simple">
<li><p><strong>Current:</strong>
This method doesn’t change vertices consisting vertex group, it only recalculates weights of
these vertices. It works well if there is not more then 4 vertices in current vertex group.</p></li>
<li><p><strong>n nearest joints:</strong>
Takes vertex groups of n already calculated joints and mixes them to match goint location
as close as possible</p></li>
<li><p><strong>Nearest bone:</strong>
Takes vertex groups of 2 joints of nearest already calculated bone and mix their vertex
groups to snap selected joint to middle of existing bone as close as possible to current
joint location.</p></li>
<li><p><strong>Neighbors equal:</strong>
Snaps joint exactly to the center of neighbor joints (parent and child bones)</p></li>
<li><p><strong>Neighbors weighted:</strong>
Snaps joints to the middle of parent and child joints as close to current joint location
as possible</p></li>
</ul>
<p>When all vertex groups are calculated you can either use these groups directly in char.blend
or you can export them to npz file and place them to
“data/characters/{your character}/joints/{rig name}.npz”.
You need to use “joint_” regular expression for exporting.</p>
</section>
<section id="config">
<h2>Config<a class="headerlink" href="#config" title="Link to this heading"></a></h2>
<p>Currently Charmorph has these configuration options documented.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Options</p></th>
<th class="head"><p>Required?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>title</p></td>
<td><p>Any</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>author</p></td>
<td><p>Any</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>license</p></td>
<td><p>Any</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>additional_authors</p></td>
<td><p>Any</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>char_obj</p></td>
<td><p>Has to match object Name in char.blend file</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>basis</p></td>
<td><p>Has to match shapekey basis name that L2 morphs were based on</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1980, Your Name.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>